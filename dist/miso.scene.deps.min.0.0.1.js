/**
* Miso.Rig - v0.0.1 - 9/24/2012
* http://github.com/misoproject/rig
* Copyright (c) 2012 Alex Graul, Irene Ros, Rich Harris;
* Dual Licensed: MIT, GPL
* https://github.com/misoproject/scene/blob/master/LICENSE-MIT 
* https://github.com/misoproject/scene/blob/master/LICENSE-GPL 
*/
(function(a,b){function bv(a){return new bw(a)}function bw(a){if(a&&a.__wrapped__)return a;this.__wrapped__=a}function bH(a,b,c){b||(b=0);var d=a.length,e=d-b>=(c||n),f=e?{}:a;if(e){var g,h=b-1;while(++h<d)g=a[h]+"",(G.call(f,g)?f[g]:f[g]=[]).push(a[h])}return function(a){if(e){var c=a+"";return G.call(f,c)&&cU(f[c],a)>-1}return cU(f,a,b)>-1}}function bI(){var a,b,c,d=-1,e=arguments.length,f={bottom:"",exit:"",init:"",top:"",arrayBranch:{beforeLoop:""},objectBranch:{beforeLoop:""}};while(++d<e){a=arguments[d];for(b in a)c=(c=a[b])==null?"":c,/beforeLoop|inLoop/.test(b)?(typeof c=="string"&&(c={array:c,object:c}),f.arrayBranch[b]=c.array||"",f.objectBranch[b]=c.object||""):f[b]=c}var g=f.args,i=/^[^,]+/.exec(g)[0],j=f.useStrict;f.firstArg=i,f.hasDontEnumBug=bc,f.isKeysFast=bm,f.noArgsEnum=bf,f.shadowed=A,f.useHas=f.useHas!==!1,f.useStrict=j==null?bn:j,f.noCharByIndex==null&&(f.noCharByIndex=bi),f.exit||(f.exit="if (!"+i+") return result");if(i!="collection"||!f.arrayBranch.inLoop)f.arrayBranch=null;var k=Function("arrayLikeClasses, ArrayProto, bind, compareAscending, concat, forIn, hasOwnProperty, identity, indexOf, isArguments, isArray, isFunction, isPlainObject, iteratorBind, objectClass, objectTypes, nativeKeys, propertyIsEnumerable, slice, stringClass, toString","var callee = function("+g+") {\n"+bx(f)+"\n};\n"+"return callee");return k(bp,h,dj,bJ,F,ca,G,dw,cU,bT,bU,bV,bX,bN,Z,bt,P,I,J,_,K)}function bJ(a,c){var d=a.index,e=c.index;a=a.criteria,c=c.criteria;if(a!==c){if(a>c||a===b)return 1;if(a<c||c===b)return-1}return d<e?-1:1}function bK(a,b){return E[b]}function bL(a){return"\\"+bu[a]}function bM(a){return br[a]}function bN(a,b){return function(c,d,e){return a.call(b,c,d,e)}}function bO(){}function bP(a,b){if(a&&p.test(b))return"<e%-"+b+"%>";var c=E.length;return E[c]="' +\n__e("+b+") +\n'",C+c+D}function bQ(a,b,c,d){if(d){var e=E.length;return E[e]="';\n"+d+";\n__p += '",C+e+D}return b?bP(null,b):bR(null,c)}function bR(a,b){if(a&&p.test(b))return"<e%="+b+"%>";var c=E.length;return E[c]="' +\n((__t = ("+b+")) == null ? '' : __t) +\n'",C+c+D}function bS(a){return bs[a]}function bT(a){return K.call(a)==T}function bV(a){return typeof a=="function"}function bW(a,b){var c=!1;if(!a||typeof a!="object"||!b&&bT(a))return c;var d=a.constructor;return(!bj||typeof a.toString=="function"||typeof (a+"")!="string")&&(!bV(d)||d instanceof d)?be?(ca(a,function(a,b,d){return c=!G.call(d,b),!1}),c===!1):(ca(a,function(a,b){c=b}),c===!1||G.call(a,c)):c}function bZ(a,b,c,d){if(a==null)return a;c&&(b=!1),d||(d={thorough:null}),d.thorough==null&&(d.thorough=!!(i.clone||k.clone||l.clone));var e=bt[typeof a];if((e||d.thorough)&&a.clone&&bV(a.clone))return d.thorough=null,a.clone(b);if(e){var f=K.call(a);if(!bq[f]||bg&&bT(a))return a;var g=f==U;e=g||(f==Z?bX(a,!0):e)}if(!e||!b)return e?g?J.call(a):b_({},a):a;var h=a.constructor;switch(f){case V:return new h(a==!0);case W:return new h(+a);case Y:case _:return new h(a);case $:return h(a.source,u.exec(a))}var j=d.clones||(d.clones=[]),m=d.sources||(d.sources=[]),n=j.length;while(n--)if(m[n]==a)return j[n];var o=g?h(n=a.length):{};j.push(o),m.push(a);if(g){var p=-1;while(++p<n)o[p]=bZ(a[p],b,null,d)}else cb(a,function(a,c){o[c]=bZ(a,b,null,d)});return o}function cd(a,b){return a?G.call(a,b):!1}function cf(a){return a===!0||a===!1||K.call(a)==V}function cg(a){return K.call(a)==W}function ch(a){return a?a.nodeType===1:!1}function cj(a,b,c){if(a==null||b==null)return a===b;c||(c={thorough:null}),c.thorough==null&&(c.thorough=!!(i.isEqual||k.isEqual||l.isEqual));if(bt[typeof a]||bt[typeof b]||c.thorough){a=a.__wrapped__||a,b=b.__wrapped__||b;if(a.isEqual&&bV(a.isEqual))return c.thorough=null,a.isEqual(b);if(b.isEqual&&bV(b.isEqual))return c.thorough=null,b.isEqual(a)}if(a===b)return a!==0||1/a==1/b;var d=K.call(a);if(d!=K.call(b))return!1;switch(d){case V:case W:return+a==+b;case Y:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case $:case _:return a==b+""}var e=bp[d];if(bg&&!e&&(e=bT(a))&&!bT(b))return!1;if(!e&&(d!=Z||bj&&(typeof a.toString!="function"&&typeof (a+"")=="string"||typeof b.toString!="function"&&typeof (b+"")=="string")))return!1;var f=c.stackA||(c.stackA=[]),g=c.stackB||(c.stackB=[]),h=f.length;while(h--)if(f[h]==a)return g[h]==b;var j=-1,m=!0,n=0;f.push(a),g.push(b);if(e){n=a.length,m=n==b.length;if(m)while(n--)if(!(m=cj(a[n],b[n],c)))break;return m}var o=a.constructor,p=b.constructor;if(o!=p&&!(bV(o)&&o instanceof o&&bV(p)&&p instanceof p))return!1;for(var q in a)if(G.call(a,q)){n++;if(!G.call(b,q)||!cj(a[q],b[q],c))return!1}for(q in b)if(G.call(b,q)&&!(n--))return!1;if(bc)while(++j<7){q=A[j];if(G.call(a,q)&&(!G.call(b,q)||!cj(a[q],b[q],c)))return!1}return!0}function ck(a){return O(a)&&K.call(a)==Y}function cl(a){return a?bt[typeof a]:!1}function cm(a){return K.call(a)==Y&&a!=+a}function cn(a){return a===null}function co(a){return K.call(a)==Y}function cp(a){return K.call(a)==$}function cq(a){return K.call(a)==_}function cr(a){return a===b}function cJ(a,b,c,d){if(!a)return c;var e=a.length,f=arguments.length<3;d&&(b=bN(b,d));if(e>-1&&e===e>>>0){var g=bi&&K.call(a)==_?a.split(""):a;e&&f&&(c=g[--e]);while(e--)c=b(c,g[e],e,a);return c}var h,i=cs(a);e=i.length,e&&f&&(c=a[i[--e]]);while(e--)h=i[e],c=b(c,a[h],h,a);return c}function cL(a){if(!a)return 0;var b=a.length;return b>-1&&b===b>>>0?b:cs(a).length}function cO(a){if(!a)return[];if(a.toArray&&bV(a.toArray))return a.toArray();var b=a.length;return b>-1&&b===b>>>0?(bh?K.call(a)==_:typeof a=="string")?a.split(""):J.call(a):cx(a)}function cQ(a){var b=[];if(!a)return b;var c=-1,d=a.length;while(++c<d)a[c]&&b.push(a[c]);return b}function cR(a){var b=[];if(!a)return b;var c=-1,d=a.length,e=F.apply(b,arguments),f=bH(e,d);while(++c<d)f(a[c])||b.push(a[c]);return b}function cS(a,b,c){if(a)return b==null||c?a[0]:J.call(a,0,b)}function cT(a,b){var c=[];if(!a)return c;var d,e=-1,f=a.length;while(++e<f)d=a[e],bU(d)?H.apply(c,b?d:cT(d)):c.push(d);return c}function cU(a,b,c){if(!a)return-1;var d=-1,e=a.length;if(c)if(typeof c=="number")d=(c<0?Q(0,e+c):c)-1;else return d=dd(a,b),a[d]===b?d:-1;while(++d<e)if(a[d]===b)return d;return-1}function cV(a,b,c){return a?J.call(a,0,-(b==null||c?1:b)):[]}function cW(a){var b=[];if(!a)return b;var c,d=arguments.length,e=[],f=-1,g=a.length;a:while(++f<g){c=a[f];if(cU(b,c)<0){for(var h=1;h<d;h++)if(!(e[h]||(e[h]=bH(arguments[h])))(c))continue a;b.push(c)}}return b}function cX(a,b,c){if(a){var d=a.length;return b==null||c?a[d-1]:J.call(a,-b||d)}}function cY(a,b,c){if(!a)return-1;var d=a.length;c&&typeof c=="number"&&(d=(c<0?Q(0,d+c):R(c,d-1))+1);while(d--)if(a[d]===b)return d;return-1}function cZ(a,b,c){var d=-Infinity,e=d;if(!a)return e;var f,g=-1,h=a.length;if(!b){while(++g<h)a[g]>e&&(e=a[g]);return e}c&&(b=bN(b,c));while(++g<h)f=b(a[g],g,a),f>d&&(d=f,e=a[g]);return e}function c$(a,b,c){var d=Infinity,e=d;if(!a)return e;var f,g=-1,h=a.length;if(!b){while(++g<h)a[g]<e&&(e=a[g]);return e}c&&(b=bN(b,c));while(++g<h)f=b(a[g],g,a),f<d&&(d=f,e=a[g]);return e}function c_(a,b){if(!a)return{};var c=-1,d=a.length,e={};while(++c<d)b?e[a[c]]=b[c]:e[a[c][0]]=a[c][1];return e}function da(a,b,c){a=+a||0,c=+c||1,b==null&&(b=a,a=0);var d=-1,e=Q(0,Math.ceil((b-a)/c)),f=Array(e);while(++d<e)f[d]=a,a+=c;return f}function db(a,b,c){return a?J.call(a,b==null||c?1:b):[]}function dc(a){if(!a)return[];var b,c=-1,d=a.length,e=Array(d);while(++c<d)b=M(S()*(c+1)),e[c]=e[b],e[b]=a[c];return e}function dd(a,b,c,d){if(!a)return 0;var e,f=0,g=a.length;if(c){d&&(c=dj(c,d)),b=c(b);while(f<g)e=f+g>>>1,c(a[e])<b?f=e+1:g=e}else while(f<g)e=f+g>>>1,a[e]<b?f=e+1:g=e;return f}function de(){var a=-1,b=[],c=F.apply(b,arguments),d=c.length;while(++a<d)cU(b,c[a])<0&&b.push(c[a]);return b}function df(a,b,c,d){var e=[];if(!a)return e;var f,g=-1,h=a.length,i=[];typeof b=="function"&&(d=c,c=b,b=!1),c?d&&(c=bN(c,d)):c=dw;while(++g<h){f=c(a[g],g,a);if(b?!g||i[i.length-1]!==f:cU(i,f)<0)i.push(f),e.push(a[g])}return e}function dg(a){var b=[];if(!a)return b;var c=-1,d=a.length,e=bH(arguments,1,20);while(++c<d)e(a[c])||b.push(a[c]);return b}function dh(a){if(!a)return[];var b=-1,c=cZ(cH(arguments,"length")),d=Array(c);while(++b<c)d[b]=cH(arguments,b);return d}function di(a,b){return a<1?b():function(){if(--a<1)return b.apply(this,arguments)}}function dj(a,b){function f(){var g=arguments,h=b;d||(a=b[c]),e.length&&(g=g.length?e.concat(J.call(g)):e);if(this instanceof f){bO.prototype=a.prototype,h=new bO;var i=a.apply(h,g);return i&&bt[typeof i]?i:h}return a.apply(h,g)}var c,d=bV(a);if(!d)c=b,b=a;else if(bl||L&&arguments.length>2)return L.call.apply(L,arguments);var e=J.call(arguments,2);return f}function dl(){var a=arguments;return function(){var b=arguments,c=a.length;while(c--)b=[a[c].apply(this,b)];return b[0]}}function dm(a,b,c){function h(){g=null,c||(e=a.apply(f,d))}var d,e,f,g;return function(){var i=c&&!g;return d=arguments,f=this,ba(g),g=bb(h,b),i&&(e=a.apply(f,d)),e}}function dn(a,c){var d=J.call(arguments,2);return bb(function(){return a.apply(b,d)},c)}function dp(a){var c=J.call(arguments,1);return bb(function(){return a.apply(b,c)},1)}function dq(a,b){var c={};return function(){var d=b?b.apply(this,arguments):arguments[0];return G.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}}function dr(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}function ds(a){var b=J.call(arguments,1),c=b.length;return function(){var d,e=arguments;return e.length&&(b.length=c,H.apply(b,e)),d=b.length==1?a.call(this,b[0]):a.apply(this,b),b.length=c,d}}function dt(a,b){function h(){g=new Date,f=null,d=a.apply(e,c)}var c,d,e,f,g=0;return function(){var i=new Date,j=b-(i-g);return c=arguments,e=this,j<=0?(g=i,d=a.apply(e,c)):f||(f=bb(h,j)),d}}function du(a,b){return function(){var c=[a];return arguments.length&&H.apply(c,arguments),b.apply(this,c)}}function dv(a){return a==null?"":(a+"").replace(y,bM)}function dw(a){return a}function dx(a){cD(cc(a),function(b){var c=bv[b]=a[b];bw.prototype[b]=function(){var a=[this.__wrapped__];arguments.length&&H.apply(a,arguments);var b=c.apply(bv,a);return this.__chain__&&(b=new bw(b),b.__chain__=!0),b}})}function dy(){return a._=o,this}function dz(a,b){return a==null&&b==null?S():(a=+a||0,b==null&&(b=a,a=0),a+M(S()*((+b||0)-a+1)))}function dA(a,b){if(!a)return null;var c=a[b];return bV(c)?a[b]():c}function dB(a,b,g){g||(g={}),a+="";var h,i,j=g.escape,k=g.evaluate,l=g.interpolate,m=bv.templateSettings,n=g.variable||m.variable,o=n;j==null&&(j=m.escape),k==null&&(k=m.evaluate||!1),l==null&&(l=m.interpolate),j&&(a=a.replace(j,bP)),l&&(a=a.replace(l,bR)),k!=c&&(c=k,f=RegExp("<e%-([\\s\\S]+?)%>|<e%=([\\s\\S]+?)%>"+(k?"|"+k.source:""),"g")),h=E.length,a=a.replace(f,bQ),h=h!=E.length,a="__p += '"+a.replace(z,bL).replace(x,bK)+"';\n",E.length=0,o||(n=d||"obj",h?a="with ("+n+") {\n"+a+"\n}\n":(n!=d&&(d=n,e=RegExp("(\\(\\s*)"+n+"\\."+n+"\\b","g")),a=a.replace(v,"$&"+n+".").replace(e,"$1__d"))),a=(h?a.replace(r,""):a).replace(s,"$1").replace(t,"$1;"),a="function("+n+") {\n"+(o?"":n+" || ("+n+" = {});\n")+"var __t, __p = '', __e = _.escape"+(h?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":(o?"":", __d = "+n+"."+n+" || "+n)+";\n")+a+"return __p\n}",bo&&(a+="\n//@ sourceURL=/lodash/template/source["+B++ +"]");try{i=Function("_","return "+a)(bv)}catch(p){throw p.source=a,p}return b?i(b):(i.source=a,i)}function dC(a,b,c){var d=-1;if(c)while(++d<a)b.call(c,d);else while(++d<a)b(d)}function dD(a){return a==null?"":(a+"").replace(q,bS)}function dE(a){var b=m++;return a?a+b:b}function dF(a){return a=new bw(a),a.__chain__=!0,a}function dG(a,b){return b(a),a}function dH(){return this.__chain__=!0,this}function dI(){return this.__wrapped__}"use strict";var c,d,e,f,g=typeof exports=="object"&&exports&&(typeof global=="object"&&global&&global==global.global&&(a=global),exports),h=Array.prototype,i=Boolean.prototype,j=Object.prototype,k=Number.prototype,l=String.prototype,m=0,n=30,o=a._,p=/[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/,q=/&(?:amp|lt|gt|quot|#x27);/g,r=/\b__p \+= '';/g,s=/\b(__p \+=) '' \+/g,t=/(__e\(.*?\)|\b__t\)) \+\n'';/g,u=/\w*$/,v=/(?:__e|__t = )\(\s*(?![\d\s"']|this\.)/g,w=RegExp("^"+(j.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),x=/__token(\d+)__/g,y=/[&<>"']/g,z=/['\n\r\t\u2028\u2029\\]/g,A=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],B=0,C="__token",D="__",E=[],F=h.concat,G=j.hasOwnProperty,H=h.push,I=j.propertyIsEnumerable,J=h.slice,K=j.toString,L=w.test(L=J.bind)&&L,M=Math.floor,N=w.test(N=Array.isArray)&&N,O=a.isFinite,P=w.test(P=Object.keys)&&P,Q=Math.max,R=Math.min,S=Math.random,T="[object Arguments]",U="[object Array]",V="[object Boolean]",W="[object Date]",X="[object Function]",Y="[object Number]",Z="[object Object]",$="[object RegExp]",_="[object String]",ba=a.clearTimeout,bb=a.setTimeout,bc,bd,be,bf=!0;(function(){function c(){this.x=1}var a={0:1,length:1},b=[];c.prototype={valueOf:1,y:1};for(var d in new c)b.push(d);for(d in arguments)bf=!d;bc=(b+"").length<4,be=b[0]!="x",bd=(b.splice.call(a,0,1),a[0])})(1);var bg=!bT(arguments),bh=J.call("x")[0]!="x",bi="x"[0]+Object("x")[0]!="xx";try{var bj=({toString:0}+"",K.call(a.document||0)==Z)}catch(bk){}var bl=L&&/\n|Opera/.test(L+K.call(a.opera)),bm=P&&/^.+$|true/.test(P+!!a.attachEvent),bn=!bl;try{var bo=(Function("//@")(),!a.attachEvent)}catch(bk){}var bp={};bp[V]=bp[W]=bp[X]=bp[Y]=bp[Z]=bp[$]=!1,bp[T]=bp[U]=bp[_]=!0;var bq={};bq[T]=bq[X]=!1,bq[U]=bq[V]=bq[W]=bq[Y]=bq[Z]=bq[$]=bq[_]=!0;var br={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},bs={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'"},bt={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1,unknown:!0},bu={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"};bv.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:""};var bx=dB("<% if (useStrict) { %>'use strict';\n<% } %>var index, value, iteratee = <%= firstArg %>, result<% if (init) { %> = <%= init %><% } %>;\n<%= exit %>;\n<%= top %>;\n<% if (arrayBranch) { %>var length = iteratee.length; index = -1;  <% if (objectBranch) { %>\nif (length > -1 && length === length >>> 0) {<% } %>  <% if (noCharByIndex) { %>\n  if (toString.call(iteratee) == stringClass) {\n    iteratee = iteratee.split('')\n  }  <% } %>\n  <%= arrayBranch.beforeLoop %>;\n  while (++index < length) {\n    value = iteratee[index];\n    <%= arrayBranch.inLoop %>\n  }  <% if (objectBranch) { %>\n}<% } %><% } %><% if (objectBranch) { %>  <% if (arrayBranch) { %>\nelse {  <%  } else if (noArgsEnum) { %>\n  var length = iteratee.length; index = -1;\n  if (length && isArguments(iteratee)) {\n    while (++index < length) {\n      value = iteratee[index += ''];\n      <%= objectBranch.inLoop %>\n    }\n  } else {  <% } %>  <% if (!hasDontEnumBug) { %>\n  var skipProto = typeof iteratee == 'function' && \n    propertyIsEnumerable.call(iteratee, 'prototype');\n  <% } %>  <% if (isKeysFast && useHas) { %>\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iteratee] ? nativeKeys(iteratee) : [],\n      length = ownProps.length;\n\n  <%= objectBranch.beforeLoop %>;\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    <% if (!hasDontEnumBug) { %>if (!(skipProto && index == 'prototype')) {\n  <% } %>    value = iteratee[index];\n    <%= objectBranch.inLoop %>\n    <% if (!hasDontEnumBug) { %>}\n<% } %>  }  <% } else { %>\n  <%= objectBranch.beforeLoop %>;\n  for (index in iteratee) {<%    if (!hasDontEnumBug || useHas) { %>\n    if (<%      if (!hasDontEnumBug) { %>!(skipProto && index == 'prototype')<% }      if (!hasDontEnumBug && useHas) { %> && <% }      if (useHas) { %>hasOwnProperty.call(iteratee, index)<% }    %>) {    <% } %>\n    value = iteratee[index];\n    <%= objectBranch.inLoop %>;\n    <% if (!hasDontEnumBug || useHas) { %>}\n<% } %>  }  <% } %>  <% if (hasDontEnumBug) { %>\n\n  var ctor = iteratee.constructor;\n    <% for (var k = 0; k < 7; k++) { %>\n  index = '<%= shadowed[k] %>';\n  if (<%      if (shadowed[k] == 'constructor') {        %>!(ctor && ctor.prototype === iteratee) && <%      } %>hasOwnProperty.call(iteratee, index)) {\n    value = iteratee[index];\n    <%= objectBranch.inLoop %>\n  }    <% } %>  <% } %>  <% if (arrayBranch || noArgsEnum) { %>\n}<% } %><% } %>\n<%= bottom %>;\nreturn result"),by={args:"collection, callback, thisArg",init:"collection",top:"if (!callback) {\n  callback = identity\n}\nelse if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"if (callback(value, index, collection) === false) return result"},bz={init:"{}",top:"var prop;\nif (typeof callback != 'function') {\n  var valueProp = callback;\n  callback = function(value) { return value[valueProp] }\n}\nelse if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"prop = callback(value, index, collection);\n(hasOwnProperty.call(result, prop) ? result[prop]++ : result[prop] = 1)"},bA={init:"true",inLoop:"if (!callback(value, index, collection)) return !result"},bB={useHas:!1,useStrict:!1,args:"object",init:"object",top:"for (var argsIndex = 1, argsLength = arguments.length; argsIndex < argsLength; argsIndex++) {\n  if (iteratee = arguments[argsIndex]) {",inLoop:"result[index] = value",bottom:"  }\n}"},bC={init:"[]",inLoop:"callback(value, index, collection) && result.push(value)"},bD={top:"if (thisArg) callback = iteratorBind(callback, thisArg)"},bE={inLoop:{object:by.inLoop}},bF={init:"",exit:"if (!collection) return []",beforeLoop:{array:"result = Array(length)",object:"result = "+(bm?"Array(length)":"[]")},inLoop:{array:"result[index] = callback(value, index, collection)",object:"result"+(bm?"[ownIndex] = ":".push")+"(callback(value, index, collection))"}},bG={useHas:!1,args:"object, callback, thisArg",init:"{}",top:"var isFunc = typeof callback == 'function';\nif (!isFunc) {\n  var props = concat.apply(ArrayProto, arguments)\n} else if (thisArg) {\n  callback = iteratorBind(callback, thisArg)\n}",inLoop:"if (isFunc\n  ? !callback(value, index, object)\n  : indexOf(props, index) < 0\n) result[index] = value"};bg&&(bT=function(a){return!!a&&!!G.call(a,"callee")});var bU=N||function(a){return K.call(a)==U};bV(/x/)&&(bV=function(a){return K.call(a)==X});var bX=bt.__proto__!=j?bW:function(a,b){if(!a)return!1;var c=a.valueOf,d=typeof c=="function"&&(d=c.__proto__)&&d.__proto__;return d?a==d||a.__proto__==d&&(b||!bT(a)):bW(a)},bY=bI({args:"object",init:"[]",inLoop:"result.push(index)"}),b$=bI(bB,{inLoop:"if (result[index] == null) "+bB.inLoop}),b_=bI(bB),ca=bI(by,bD,bE,{useHas:!1}),cb=bI(by,bD,bE),cc=bI({useHas:!1,args:"object",init:"[]",inLoop:"if (isFunction(value)) result.push(index)",bottom:"result.sort()"}),ce=bI({args:"object",init:"{}",inLoop:"result[value] = index"}),ci=bI({args:"value",init:"true",top:"var className = toString.call(value),\n    length = value.length;\nif (arrayLikeClasses[className]"+(bg?" || isArguments(value)":"")+" ||\n"+"  (className == objectClass && length > -1 && length === length >>> 0 &&\n"+"  isFunction(value.splice))"+") return !length",inLoop:{object:"return false"}}),cs=P?function(a){var b=typeof a;return b=="function"&&I.call(a,"prototype")?bY(a):a&&bt[b]?P(a):[]}:bY,ct=bI(bB,{args:"object, source, indicator",top:"var isArr, recursive = indicator == isPlainObject,\n    data = recursive ? arguments[3] : { values: [], sources: [] };\nfor (var argsIndex = 1, argsLength = recursive ? 2 : arguments.length; argsIndex < argsLength; argsIndex++) {\n  if (iteratee = arguments[argsIndex]) {",inLoop:"if ((source = value) && ((isArr = isArray(source)) || isPlainObject(source))) {\n  var found = false, values = data.values, sources = data.sources, stackLength = sources.length;\n  while (stackLength--) {\n    if (found = sources[stackLength] == source) break\n  }\n  if (found) {\n    result[index] = values[stackLength]\n  } else {\n    values.push(value = (value = result[index]) && isArr\n      ? (isArray(value) ? value : [])\n      : (isPlainObject(value) ? value : {})\n    );\n    sources.push(source);\n    result[index] = callee(value, source, isPlainObject, data)\n  }\n} else if (source != null) {\n  result[index] = source\n}"}),cu=bI(bG),cv=bI({args:"object",init:"[]",inLoop:"result"+(bm?"[ownIndex] = ":".push")+"([index, value])"}),cw=bI(bG,{top:"if (typeof callback != 'function') {\n  var prop,\n      props = concat.apply(ArrayProto, arguments),\n      length = props.length;\n  for (index = 1; index < length; index++) {\n    prop = props[index];\n    if (prop in object) result[prop] = object[prop]\n  }\n} else {\n  if (thisArg) callback = iteratorBind(callback, thisArg)",inLoop:"if (callback(value, index, object)) result[index] = value",bottom:"}"}),cx=bI({args:"object",init:"[]",inLoop:"result.push(value)"}),cy=bI({args:"collection, target",init:"false",noCharByIndex:!1,beforeLoop:{array:"if (toString.call(collection) == stringClass) return collection.indexOf(target) > -1"},inLoop:"if (value === target) return true"}),cz=bI(by,bz),cA=bI(by,bA),cB=bI(by,bC),cC=bI(by,bD,{init:"",inLoop:"if (callback(value, index, collection)) return value"}),cD=bI(by,bD),cE=bI(by,bz,{inLoop:"prop = callback(value, index, collection);\n(hasOwnProperty.call(result, prop) ? result[prop] : result[prop] = []).push(value)"}),cF=bI(bF,{args:"collection, methodName",top:"var args = slice.call(arguments, 2),\n    isFunc = typeof methodName == 'function'",inLoop:{array:"result[index] = (isFunc ? methodName : value[methodName]).apply(value, args)",object:"result"+(bm?"[ownIndex] = ":".push")+"((isFunc ? methodName : value[methodName]).apply(value, args))"}}),cG=bI(by,bF),cH=bI(bF,{args:"collection, property",inLoop:{array:"result[index] = value[property]",object:"result"+(bm?"[ownIndex] = ":".push")+"(value[property])"}}),cI=bI({args:"collection, callback, accumulator, thisArg",init:"accumulator",top:"var noaccum = arguments.length < 3;\nif (thisArg) callback = iteratorBind(callback, thisArg)",beforeLoop:{array:"if (noaccum) result = iteratee[++index]"},inLoop:{array:"result = callback(result, value, index, collection)",object:"result = noaccum\n  ? (noaccum = false, value)\n  : callback(result, value, index, collection)"}}),cK=bI(by,bC,{inLoop:"!"+bC.inLoop}),cM=bI(by,bA,{init:"false",inLoop:bA.inLoop.replace("!","")}),cN=bI(by,bz,bF,{inLoop:{array:"result[index] = {\n  criteria: callback(value, index, collection),\n  index: index,\n  value: value\n}",object:"result"+(bm?"[ownIndex] = ":".push")+"({\n"+"  criteria: callback(value, index, collection),\n"+"  index: index,\n"+"  value: value\n"+"})"},bottom:"result.sort(compareAscending);\nlength = result.length;\nwhile (length--) {\n  result[length] = result[length].value\n}"}),cP=bI(bC,{args:"collection, properties",top:"var props = [];\nforIn(properties, function(value, prop) { props.push(prop) });\nvar propsLength = props.length",inLoop:"for (var prop, pass = true, propIndex = 0; propIndex < propsLength; propIndex++) {\n  prop = props[propIndex];\n  if (!(pass = value[prop] === properties[prop])) break\n}\npass && result.push(value)"}),dk=bI({useHas:!1,useStrict:!1,args:"object",init:"object",top:"var funcs = arguments,\n    length = funcs.length;\nif (length > 1) {\n  for (var index = 1; index < length; index++) {\n    result[funcs[index]] = bind(result[funcs[index]], result)\n  }\n  return result\n}",inLoop:"if (isFunction(result[index])) {\n  result[index] = bind(result[index], result)\n}"});bv.VERSION="0.7.0",bv.after=di,bv.bind=dj,bv.bindAll=dk,bv.chain=dF,bv.clone=bZ,bv.compact=cQ,bv.compose=dl,bv.contains=cy,bv.countBy=cz,bv.debounce=dm,bv.defaults=b$,bv.defer=dp,bv.delay=dn,bv.difference=cR,bv.escape=dv,bv.every=cA,bv.extend=b_,bv.filter=cB,bv.find=cC,bv.first=cS,bv.flatten=cT,bv.forEach=cD,bv.forIn=ca,bv.forOwn=cb,bv.functions=cc,bv.groupBy=cE,bv.has=cd,bv.identity=dw,bv.indexOf=cU,bv.initial=cV,bv.intersection=cW,bv.invert=ce,bv.invoke=cF,bv.isArguments=bT,bv.isArray=bU,bv.isBoolean=cf,bv.isDate=cg,bv.isElement=ch,bv.isEmpty=ci,bv.isEqual=cj,bv.isFinite=ck,bv.isFunction=bV,bv.isNaN=cm,bv.isNull=cn,bv.isNumber=co,bv.isObject=cl,bv.isRegExp=cp,bv.isString=cq,bv.isUndefined=cr,bv.keys=cs,bv.last=cX,bv.lastIndexOf=cY,bv.map=cG,bv.max=cZ,bv.memoize=dq,bv.merge=ct,bv.min=c$,bv.mixin=dx,bv.noConflict=dy,bv.object=c_,bv.omit=cu,bv.once=dr,bv.pairs=cv,bv.partial=ds,bv.pick=cw,bv.pluck=cH,bv.random=dz,bv.range=da,bv.reduce=cI,bv.reduceRight=cJ,bv.reject=cK,bv.rest=db,bv.result=dA,bv.shuffle=dc,bv.size=cL,bv.some=cM,bv.sortBy=cN,bv.sortedIndex=dd,bv.tap=dG,bv.template=dB,bv.throttle=dt,bv.times=dC,bv.toArray=cO,bv.unescape=dD,bv.union=de,bv.uniq=df,bv.uniqueId=dE,bv.values=cx,bv.where=cP,bv.without=dg,bv.wrap=du,bv.zip=dh,bv.all=cA,bv.any=cM,bv.collect=cG,bv.detect=cC,bv.drop=db,bv.each=cD,bv.foldl=cI,bv.foldr=cJ,bv.head=cS,bv.include=cy,bv.inject=cI,bv.methods=cc,bv.select=cB,bv.tail=db,bv.take=cS,bv.unique=df,bv._iteratorTemplate=bx,bv._shimKeys=bY,bw.prototype=bv.prototype,dx(bv),bw.prototype.chain=dH,bw.prototype.value=dI,cD(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=h[a];bw.prototype[a]=function(){var a=this.__wrapped__;return b.apply(a,arguments),bd&&a.length===0&&delete a[0],this.__chain__&&(a=new bw(a),a.__chain__=!0),a}}),cD(["concat","join","slice"],function(a){var b=h[a];bw.prototype[a]=function(){var a=this.__wrapped__,c=b.apply(a,arguments);return this.__chain__&&(c=new bw(c),c.__chain__=!0),c}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(a._=bv,define(function(){return bv})):g?typeof module=="object"&&module&&module.exports==g?(module.exports=bv)._=bv:g._=bv:a._=bv})(this),function(a){function r(a){var b=q[a]={};return j(a.split(/\s+/),function(a){b[a]=!0}),b}var b={},c=Array.prototype,d=Object.prototype,e=d.hasOwnProperty,f=d.toString,g=c.forEach,h=c.indexOf,i=c.slice,j=function(a,c,d){var f,h,i;if(!a)return;if(g&&a.forEach===g)a.forEach(c,d);else if(a.length===+a.length){for(h=0,i=a.length;h<i;h++)if(h in a&&c.call(d,a[h],h,a)===b)return}else for(f in a)if(e.call(a,f)&&c.call(d,a[f],f,a)===b)return},k=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},l=function(a){return j(i.call(arguments,1),function(b){var c;for(c in b)b[c]!==void 0&&(a[c]=b[c])}),a},m=function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},n={};j("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){n["[object "+a+"]"]=a.toLowerCase()});var o=function(a){return a==null?String(a):n[f.call(a)]||"object"},p={},q={};p.Callbacks=function(a){a=typeof a=="string"?q[a]||r(a):l({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],k=function(j){b=a.memory&&j,c=!0,g=e||0,e=0,f=h.length,d=!0;for(;h&&g<f;g++)if(h[g].apply(j[0],j[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,h&&(i?i.length&&k(i.shift()):b?h=[]:n.disable())},n={add:function(){if(h){var c=h.length;(function g(b){j(b,function(b){var c=o(b);c==="function"&&(!a.unique||!n.has(b))?h.push(b):b&&b.length&&c!=="string"&&g(b)})})(arguments),d?f=h.length:b&&(e=c,k(b))}return this},remove:function(){return h&&j(arguments,function(a){var b;while((b=m(a,h,b))>-1)h.splice(b,1),d&&(b<=f&&f--,b<=g&&g--)}),this},has:function(a){return m(a,h)>-1},empty:function(){return h=[],this},disable:function(){return h=i=b=undefined,this},disabled:function(){return!h},lock:function(){return i=undefined,b||n.disable(),this},locked:function(){return!i},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],h&&(!c||i)&&(d?i.push(b):k(b)),this},fire:function(){return n.fireWith(this,arguments),this},fired:function(){return!!c}};return n},p.Deferred=function(a){var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return p.Deferred(function(c){j(b,function(b,d){var f=b[0],g=a[d];e[b[1]](k(g)?function(){var a=g.apply(this,arguments);a&&k(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return typeof a=="object"?l(a,d):d}},e={};return d.pipe=d.then,j(b,function(a,f){var g=a[2],h=a[3];d[a[1]]=g.add,h&&g.add(function(){c=h},b[f^1][2].disable,b[2][2].lock),e[a[0]]=g.fire,e[a[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},p.when=function(a){var b=0,c=i.call(arguments),d=c.length,e=d!==1||a&&k(a.promise)?d:0,f=e===1?a:p.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?i.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,j,l;if(d>1){h=new Array(d),j=new Array(d),l=new Array(d);for(;b<d;b++)c[b]&&k(c[b].promise)?c[b].promise().done(g(b,l,c)).fail(f.reject).progress(g(b,j,h)):--e}return e||f.resolveWith(l,c),f.promise()},typeof module!="undefined"&&module.exports?module.exports=p:typeof a._!="undefined"?a._.mixin(p):a._=p}(this),function(a,_){var b=a.Miso=a.Miso||{};b.Events={publish:function(a){var b=_.toArray(arguments);b.shift(),this._events&&this._events[a]&&_.each(this._events[a],function(a){a.callback.apply(a.context||this,b)},this)},subscribe:function(a,b,c){c=c||{},this._events=this._events||{},this._events[a]=this._events[a]||[];var d={callback:b,priority:c.priority||0,token:c.token||_.uniqueId("t"),context:c.context||this},e;return _.each(this._events[a],function(a,b){if(!_.isUndefined(e))return;a.priority<=d.priority&&(e=b)}),this._events[a].splice(e,0,d),d.token},subscribeOnce:function(a,b){this._events=this._events||{};var c=_.uniqueId("t");return this.subscribe(a,function(){this.unsubscribe(a,{token:c}),b.apply(this,arguments)},this,c)},unsubscribe:function(a,b){if(_.isUndefined(this._events[a]))return this;_.isFunction(b)?this._events[a]=_.reject(this._events[a],function(a){return a.callback===b}):_.isString(b)?this._events[a]=_.reject(this._events[a],function(a){return a.token===b}):this._events[a]=[]}}}(this,_),function(a,_,b){var c=a.Miso=a.Miso||{},d=c.Util=c.Util||{};d._wrap=function(a,b){if(!_.isFunction(a))return a;if(/^_/.test(b))return a;if(a.__wrapped)return a;var c=function(b,c){var d=!1,e;return c=c||_.Deferred(),this.async=function(){return d=!0,function(a){return a!==!1?c.resolve():c.reject()}},e=a.apply(this,b),this.async=undefined,d?c.promise():e!==!1?c.resolve():c.reject()};return c.__wrapped=!0,c}}(this,_,$),function(a,_){function e(a,b,c){this._transitioning=!0;var d=this._complete=c||_.Deferred(),e=b?b:[],f=_.Deferred().done(_.bind(function(){this._transitioning=!1,this._current=a,d.resolve()},this)).fail(_.bind(function(){this._transitioning=!1,d.reject()},this));return this.handlers[a].call(this._context,e,f),d.promise()}function f(a,b,c){var d=this.children[a],e=this._current,f=b?b:[],g=this._complete=c||_.Deferred(),h=_.Deferred(),i=_.Deferred(),j=_.bind(function(a){this.publish(a,e?e.name:null,d.name)},this),k=_.bind(function(){this._transitioning=!1,g.reject(),j("fail")},this),l=_.bind(function(){this._transitioning=!1,this._current=d,g.resolve(),j("done")},this);if(!d)throw"Scene '"+a+"' not found!";return j("start"),this._transitioning?g.reject():(this._transitioning=!0,e?e.to("exit",f,h).done(function(){d.to("enter",f,i).fail(k)}).fail(k):(h.resolve(),d.to("enter",f,i).fail(k)),_.when(h,i).then(l),g.promise())}var b=a.Miso=a.Miso||{},c=b.Util,d=b.Scene=function(a){a=a||{},this._context=a.context||this,this._id=_.uniqueId("scene"),a.children?(this._buildChildren(a.children),this._initial=a.initial,this.to=f):(this.handlers={},_.each(d.HANDLERS,function(b){a[b]=a[b]||function(){return!0},this.handlers[b]=c._wrap(a[b],b)},this),this.to=e),_.each(a,function(a,b){if(_.indexOf(d.BLACKLIST,b)!==-1)return;this[b]=a},this)};d.HANDLERS=["enter","exit"],d.BLACKLIST=["initial","children","enter","exit","context"],_.extend(d.prototype,b.Events,{attach:function(a,b){this.name=a,this.parent=b,b._context&&b._context._id!==b._id&&(this._context=b._context,this.children&&_.each(this.children,function(a,b){a.attach(a.name,this)},this))},start:function(){return this._current?_.Deferred().resolve():this.to(this._initial)},cancelTransition:function(){this._complete.reject(),this._transitioning=!1},scene:function(){return this._current?this._current.name:null},is:function(a){return a===this._current.name},inTransition:function(){return this._transitioning===!0},_buildChildren:function(a){this.children={},_.each(a,function(a,c){this.children[c]=a instanceof b.Scene?a:new b.Scene(a),this.children[c].attach(c,this)},this)}})}(this,_)